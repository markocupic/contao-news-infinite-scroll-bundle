"use strict";let ContaoNewsInfiniteScroll;(function($){ContaoNewsInfiniteScroll=function(options){let _opts=$.extend({newsContainer:".mod_newslist_infinite_scroll",scrollContainer:$(window),paginationNextLink:".pagination .next > a.next",paginationLastLink:".pagination .last > a.last",loadAllOnDomready:false,loadMoreButton:true,loadMoreButtonMarkup:'<div class="inf-scr-load-more-btn-container text-center"><button class="btn btn-primary w-100"><?= $GLOBALS["TL_LANG"]["MSC"]["infScrLoadMore"] ?></button></div>',anchorPoint:".mod_newslist_infinite_scroll",bottomPixels:100,fadeInTime:400,loadingInProcessContainer:'<div class="inf-scr-loading-in-process-container text-center"><i class="fa fa-5x fa-spinner fa-spin"></i>{{br}}{{br}}<?= $GLOBALS["TL_LANG"]["MSC"]["infScrLoadingInProcess"] ?>...</em></div>',onInitialize:function(instance){},onXHRStart:function(instance){},onXHRComplete:function(response,instance,xhr){return response},onXHRFail:function(instance,xhr){},onBeforeAppendCallback:function(instance,xhr){},onAppendCallback:function(instance,xhr){}},options||{});let _self=this;let _newsContainer=null;let _anchorPoint=null;let _scrollContainer=null;let _blnLoadingInProcess=false;let _arrUrls=[];let _blnLoadedAllItems=false;let _xhrInterval=null;_self.blnHasError=false;_self.currentUrl="";_self.urlIndex=0;_self.response="";_self.loadMoreBtn=null;_self.xhr=null;this.getOption=function(option){if(typeof _opts[option]!=="undefined"){return _opts[option]}return false};let _initialize=function(){if(_opts.onInitialize(_self)!==true){return}_newsContainer=$(_opts.newsContainer)[0];if(typeof _newsContainer==="undefined"){return}if($(_opts.newsContainer+" "+_opts.paginationNextLink).length===0){return}if($(_opts.newsContainer+" "+_opts.paginationNextLink).length){let next=$(_opts.newsContainer+" "+_opts.paginationNextLink).first();let hrefNext=$(next).prop("href");let paginationUrlRegexPattern="page_n(\\d*)=(\\d*)";let regexpNext=new RegExp(paginationUrlRegexPattern,"g");let matchNext=regexpNext.exec(hrefNext);if(!matchNext){console.error('News infinite scroll initialization aborted! Could not find pagination link with pattern "'+paginationUrlRegexPattern+'".');return}let idModule=matchNext[1];let idNext=parseInt(matchNext[2]);let idLast=idNext;if($(_opts.newsContainer+" "+_opts.paginationLastLink).length>0){let last=$(_opts.newsContainer+" "+_opts.paginationLastLink).first();let hrefLast=$(last).prop("href");let regexpLast=new RegExp(paginationUrlRegexPattern,"g");let matchLast=regexpLast.exec(hrefLast);if(matchLast){idLast=parseInt(matchLast[2])}}for(let i=idNext;i<=idLast;i++){let url=hrefNext.replace(regexpNext,"page_n"+idModule+"="+i);_arrUrls.push(url)}}_scrollContainer=$(_opts.scrollContainer)[0];if(typeof _scrollContainer==="undefined"){console.error("ContaoNewsInfiniteScroll aborted! Please select a valid scroll container.");return}if(_opts.bottomPixels===0){_opts.bottomPixels=1}_anchorPoint=$(_newsContainer);if(typeof $(_opts.anchorPoint)[0]!=="undefined"){_anchorPoint=$(_opts.anchorPoint)[0]}if(_opts.loadAllOnDomready===true){_load();_xhrInterval=setInterval(_load,3e3)}else if(_opts.loadMoreButton===true){_self.loadMoreBtn=$(_opts.loadMoreButtonMarkup);_self.loadMoreBtn.insertAfter(_newsContainer).addClass("inf-scr-load-more-btn-container").click(event=>{$(event.currentTarget).hide();_load()})}else{$(_scrollContainer).on("scroll",()=>{if($(_scrollContainer).scrollTop()>$(_anchorPoint).offset().top+$(_anchorPoint).innerHeight()-$(_scrollContainer).height()-_opts.bottomPixels){_load()}})}};let _load=function(){if(_blnLoadingInProcess===true||_blnLoadedAllItems===true)return;_self.blnHasError=false;_self.currentUrl=_arrUrls[_self.urlIndex]+"&ajaxCall";if(typeof _self.currentUrl!=="undefined"){_self.xhr=$.ajax({url:_self.currentUrl,beforeSend:()=>{_opts.onXHRStart(_self);$(_newsContainer).attr("aria-busy","true");_blnLoadingInProcess=true;if(_opts.loadingInProcessContainer!=""){$(_opts.loadingInProcessContainer).addClass("inf-scr-loading-in-process-container").insertAfter(_newsContainer).fadeIn(100)}}}).done(data=>{_self.blnHasError=false;_self.response=data;_self.response=_opts.onXHRComplete(_self.response,_self,_self.xhr);if(_self.blnHasError===false){_self.urlIndex++;setTimeout(()=>{_appendToDom()},1e3)}else{_fail()}}).fail(()=>{_fail()}).always(()=>{setTimeout(()=>{$(".inf-scr-loading-in-process-container").remove();$(_newsContainer).attr("aria-busy","false");if(_arrUrls.length===_self.urlIndex){_blnLoadedAllItems=true;if($(_self.loadMoreBtn).length){_self.loadMoreBtn.remove();_self.loadMoreBtn=null}if(typeof _xhrInterval!=="undefined"){clearInterval(_xhrInterval)}}if(_self.loadMoreBtn!==null){_self.loadMoreBtn.show()}_blnLoadingInProcess=false},1e3)})}else{_blnLoadedAllItems=true;if(typeof _xhrInterval!=="undefined"){clearInterval(_xhrInterval)}}};let _fail=function(){_blnLoadingInProcess=false;_opts.onXHRFail(_self,_self.xhr)};let _appendToDom=function(){_opts.onBeforeAppendCallback(_self,_self.xhr);if(_self.response!=""){$(_self.response).hide().appendTo(_newsContainer).fadeIn(_opts.fadeInTime)}_opts.onAppendCallback(_self,_self.xhr)};_initialize()}})(jQuery);