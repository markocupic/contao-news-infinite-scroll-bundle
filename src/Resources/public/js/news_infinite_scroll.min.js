!function(n){ContaoNewsInfiniteScroll=function(o){var e=n.extend({newsContainer:".mod_newslist_infinite_scroll",scrollContainer:n(window),paginationNextLink:".pagination > .next > a.next",paginationLastLink:".pagination > .last > a.last",paginationUrlRegexPattern:"page_n(\\d*)=(\\d*)",loadAllOnDomready:!1,loadMoreButton:!0,loadMoreButtonMarkup:"<div><button>Load more</button></div>",anchorPoint:".mod_newslist_infinite_scroll",bottomPixels:0,fadeInTime:800,loadingInProcessContainer:'<div class="inf-scr-loading-in-process-container"><em>Loading...</em></div>',onInitialize:function(n){},onXHRStart:function(n){},onXHRComplete:function(n,o){return n},onXHRFail:function(n){},onAppendCallback:function(n){}},o||{}),t=this,r=null,a=null,l=null,s=0,d=[],c=0,u=0;t.blnHasError=!1,t.currentUrl="",t.urlIndex=0,t.response="",t.loadMoreBtn=null,this.getOption=function(n){return void 0!==e[n]&&e[n]};var f=function(){1!=s&&1!=c&&(t.blnHasError=!1,t.currentUrl=d[t.urlIndex],void 0!==t.currentUrl?n.ajax({url:t.currentUrl,beforeSend:function(){e.onXHRStart(t),n(r).attr("aria-busy","true"),s=1,""!=e.loadingInProcessContainer&&n(e.loadingInProcessContainer).addClass("inf-scr-loading-in-process-container").insertAfter(r).fadeIn(100)}}).done(function(n){t.blnHasError=!1,t.response=n;var o=e.onXHRComplete(t.response,t);!1===t.blnHasError?(t.urlIndex++,setTimeout(function(){g(o)},1e3)):p()}).fail(function(){p()}).always(function(){setTimeout(function(){n(".inf-scr-loading-in-process-container").remove(),n(r).attr("aria-busy","false"),d.length==t.urlIndex&&(c=1,n(t.loadMoreBtn).length&&(t.loadMoreBtn.remove(),t.loadMoreBtn=null),void 0!==u&&clearInterval(u)),null!==t.loadMoreBtn&&t.loadMoreBtn.show(),s=0},1e3)}):(c=1,void 0!==u&&clearInterval(u)))},p=function(){s=0,e.onXHRFail(t)},g=function(o){n(o).hide().appendTo(r).fadeIn(e.fadeInTime),e.onAppendCallback(t)};!function(){if(!0===e.onInitialize(t)&&void 0!==(r=n(e.newsContainer)[0])&&0!==n(e.newsContainer+" "+e.paginationNextLink).length){if(n(e.newsContainer+" "+e.paginationNextLink).length){let o=n(e.newsContainer+" "+e.paginationNextLink).first(),t=n(o).prop("href"),r=new RegExp(e.paginationUrlRegexPattern,"g").exec(t);if(!r)return void console.error('News infinite scroll initialization aborted! Could not find pagination link with pattern "'+e.paginationUrlRegexPattern+'".');let a=r[2],l=a;if(n(e.newsContainer+" "+e.paginationLastLink).length>0){let o=n(e.newsContainer+" "+e.paginationLastLink).first(),t=n(o).prop("href"),i=new RegExp(e.paginationUrlRegexPattern,"g").exec(t);i&&(l=i[2])}for(i=a;i<=l;i++){let n=t.replace("page_n"+r[1]+"="+r[2],"page_n"+r[1]+"="+i);d.push(n)}}void 0!==(l=n(e.scrollContainer)[0])?(0==e.bottomPixels&&(e.bottomPixels=1),a=n(r),void 0!==n(e.anchorPoint)[0]&&(a=n(e.anchorPoint)[0]),!0===e.loadAllOnDomready?(f(),u=setInterval(f,3e3)):!0===e.loadMoreButton?(t.loadMoreBtn=n(e.loadMoreButtonMarkup),t.loadMoreBtn.insertAfter(r),t.loadMoreBtn.addClass("inf-scr-load-more-btn-container"),t.loadMoreBtn.click(function(o){n(this).hide(),f()})):n(l).on("scroll",function(){n(l).scrollTop()>n(a).offset().top+n(a).innerHeight()-n(l).height()-e.bottomPixels&&f()})):console.error("ContaoNewsInfiniteScroll aborted! Please select a valid scroll container.")}}()}}(jQuery);
